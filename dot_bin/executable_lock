#!/usr/bin/env bash

# Create temporary files for the screenshot and the blurred version
screenshot_tmp=$(mktemp --suffix=.png)
screenshot_blur_tmp=$(mktemp --suffix=.png)

# Clean up temporary files on exit
trap 'rm -f "$screenshot_tmp" "$screenshot_blur_tmp"' EXIT

# 1. Take a screenshot using grim
grim "$screenshot_tmp"

# 2. Create the blurred effect using ImageMagick (this part doesn't change)
magick "$screenshot_tmp" -scale 10% -scale 1000% "$screenshot_blur_tmp"

# 3. Define the options for swaylock
swaylock_options=(
    --image "$screenshot_blur_tmp"
    --show-failed-attempts
    --indicator-idle-visible
    --clock
    --datestr "%a, %B %d"
    --timestr "%R"
)

# --- Pre-lock Actions ---

# Pause notifications
pkill -xu "$EUID" -USR1 dunst

# Pause media
playerctl -a pause

# Mute sounds
pactl set-sink-mute @DEFAULT_SINK@ toggle

# --- Lock the screen ---

swaylock "${swaylock_options[@]}"

# --- Post-lock Actions (these run after you unlock) ---

# Un-mute sounds
pactl set-sink-mute @DEFAULT_SINK@ toggle

# Unpause notifications
pkill -xu "$EUID" -USR2 dunst
